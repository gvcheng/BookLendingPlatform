<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>可借阅图书 - 图书借阅系统</title>
    <!-- 引入全局样式 -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/book-card.css}">
</head>
<body>
    <!-- 使用导航栏片段 -->
    <div th:replace="fragments/navbar :: navbar(activePage='book-available')"></div>

    <div class="bookstore-container">
        <!-- 页面标题 -->
        <div class="section-title">
            <h2 th:if="${searchKeyword}" class="section-heading">搜索结果: <span class="text-primary" th:text="${searchKeyword}"></span></h2>
            <h2 th:unless="${searchKeyword}" class="section-heading">可借阅图书</h2>
            <a th:if="${searchKeyword}" th:href="@{/book/available}" class="btn btn-sm btn-secondary">
                查看全部可借图书
            </a>
        </div>
        
        <!-- 搜索表单 -->
        <div class="search-bar">
            <form th:action="@{/book/available/search}" method="get">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="搜索图书名称、作者或ISBN" name="keyword" th:value="${searchKeyword}">
                    <div class="input-group-append">
                        <button type="submit" class="btn btn-primary">搜索</button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- 统计信息 -->
        <div class="stats-info">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h3 class="mb-0">推荐图书</h3>
                </div>
                <div class="col-md-6 text-right">
                    <span class="available-badge" th:text="'共 ' + ${books.size()} + ' 本可借阅'">共 0 本可借阅</span>
                </div>
            </div>
        </div>
        
        <!-- 图书卡片网格 -->
        <div class="book-grid" th:if="${not books.empty}">
            <!-- 单个图书卡片 -->
            <div th:each="book : ${books}" class="book-card">
                <!-- 封面容器 -->
                <div class="book-cover-container">
                    <img th:src="${book.coverImage != null ? book.coverImage : '/booklending/images/default-book-cover.png'}" 
                           th:alt="${book.title}" 
                          class="book-cover" 
                          onerror="this.src='/booklending/images/default-book-cover.png';"/>
                    <div class="availability-tag" th:text="'可借 ' + ${book.availableCopies} + ' 本'">可借 0 本</div>
                </div>
                
                <!-- 卡片内容 -->
                <div class="book-card-content">
                    <h3 class="book-title" th:text="${book.title}">图书标题</h3>
                    <p class="book-author" th:text="${book.author != null ? book.author : '未知作者'}">作者名称</p>
                    
                    <div class="book-meta">
                        <p><strong>出版社:</strong> <span th:text="${book.publisher}">出版社名称</span></p>
                    </div>
                    
                    <p class="book-description" th:text="${book.description != null ? book.description : '暂无简介'}">图书简介内容...</p>
                    
                    <!-- 操作按钮 -->
                    <div class="book-card-footer">
                        <div class="action-buttons">
                            <a th:href="@{/book/detail/{id}(id=${book.id})}" class="btn-detail">查看详情</a>
                            <form th:action="@{/borrow/borrow-book}" method="post" style="margin: 0; flex: 1;">
                                <input type="hidden" name="bookId" th:value="${book.id}">
                                <input type="hidden" name="userId" th:value="${userId}">
                                <button type="submit" class="btn-borrow" 
                                        th:disabled="${book.availableCopies <= 0}" 
                                        th:attr="title=${book.availableCopies <= 0 ? '暂无可借数量' : '立即借阅'}"
                                        style="height: 100%; width: 100%;">
                                    立即借阅
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 无图书时的空状态 -->
        <div th:if="${books.empty}" class="empty-state">
            <h3 th:if="${searchKeyword}">未找到相关图书</h3>
            <h3 th:unless="${searchKeyword}">暂无可借阅图书</h3>
            <p th:if="${searchKeyword}">没有找到与 "<span th:text="${searchKeyword}"></span>" 相关的可借阅图书</p>
            <p th:unless="${searchKeyword}">请稍后再试或联系管理员添加图书</p>
        </div>
        
        <!-- 返回按钮 -->
        <div class="back-buttons">
            <a href="/booklending/book/list" class="back-btn back-btn-secondary">返回图书列表</a>
            <a href="/booklending/" class="back-btn back-btn-primary">返回首页</a>
        </div>
    </div>
    
    <!-- 页面脚本 -->
</body>
</html>